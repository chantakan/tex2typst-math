<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Svg Document</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      type="module"
      src="https://cdn.jsdelivr.net/npm/@myriaddreamin/typst.ts@0.5.3/dist/esm/contrib/all-in-one-lite.bundle.js"
      id="typst"
    ></script>
  </head>
  <body>
    <div class="flex flex-col gap-4 w-1/2">
      <input id="input" type="text" placeholder="type mathematics" class="p-2 border rounded" />
      <input id="scale" type="range" min="1" max="3" step="0.1" value="1.5" class="w-full"/>
    </div>
    <div id="content" class="flex justify-center items-center"></div>
    <script>
      const input = document.getElementById('input');
      const scale = document.getElementById('scale');
      const contentDiv = document.getElementById('content');

      const previewSvg = () => {
        const mainContent = input.value;
        const currentScale = parseFloat(scale.value);
        
        $typst.svg({ mainContent: "$ "+ mainContent + " $" }).then(svg => {
          contentDiv.innerHTML = svg;
          const svgElem = contentDiv.firstElementChild;
          if (svgElem) {
            const typstGroup = svgElem.querySelector('.typst-group');
            if (typstGroup) {
              const bbox = typstGroup.getBBox();
              const padding = 5;
              const scaledWidth = (bbox.width + padding * 2) * currentScale;
              const scaledHeight = (bbox.height + padding * 2) * currentScale;
              
              svgElem.setAttribute('viewBox', `${bbox.x - padding} ${bbox.y - padding} ${bbox.width + padding * 2} ${bbox.height + padding * 2}`);
              svgElem.setAttribute('width', scaledWidth);
              svgElem.setAttribute('height', scaledHeight);
            }
          }
        });
      };

      document.getElementById('typst').addEventListener('load', function () {
        $typst.setCompilerInitOptions({
          getModule: () => 'https://cdn.jsdelivr.net/npm/@myriaddreamin/typst-ts-web-compiler@0.5.3/pkg/typst_ts_web_compiler_bg.wasm',
        });
        $typst.setRendererInitOptions({
          getModule: () => 'https://cdn.jsdelivr.net/npm/@myriaddreamin/typst-ts-renderer@0.5.3/pkg/typst_ts_renderer_bg.wasm',
        });

        input.oninput = previewSvg;
        scale.oninput = previewSvg;
        previewSvg();
      });
    </script>
    <style>
      body {
        margin: 0;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
      }
    </style>
  </body>
</html>